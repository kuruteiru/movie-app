<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Movie Search</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-toolbar class="search-toolbar">
    <ion-searchbar [(ngModel)]="searchQuery" (keyup.enter)="search()" placeholder="Search movies..."></ion-searchbar>
    <ion-buttons slot="end">
      <ion-button (click)="search()" fill="solid" color="primary">Search</ion-button>
    </ion-buttons>
  </ion-toolbar>

  <ion-accordion-group>
    @for (movie of movies; track movie.id) {
      <ion-accordion [value]="movie.id">
        <ion-item slot="header" lines="full">
          <ion-thumbnail slot="start" class="movie-poster">
            @if (movie.poster_path) {
              <img [src]="imageBaseUrl + movie.poster_path" />
            }
          </ion-thumbnail>

          <ion-label>
            <h2 class="movie-title">{{ movie.title }}</h2>
            <p>Rating: ‚≠ê {{ movie.vote_average }}</p>
            <ion-note color="primary">Click for details</ion-note>
          </ion-label>

          <ion-button slot="end" fill="clear" (click)="toggleFavorite(movie); $event.stopPropagation()">
            <ion-icon
              [name]="isFavorite(movie) ? 'heart' : 'heart-outline'"
              [color]="isFavorite(movie) ? 'danger' : 'medium'"
              size="large">
            </ion-icon>
          </ion-button>
        </ion-item>

        <div class="ion-padding" slot="content">
          <p><strong>Overview:</strong></p>
          <p class="overview-text">{{ movie.overview }}</p>
        </div>
      </ion-accordion>
    }
  </ion-accordion-group>

  <ion-infinite-scroll (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Loading more movies...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
